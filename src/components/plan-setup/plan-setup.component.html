
<div class="max-w-3xl mx-auto bg-white dark:bg-dark-card p-8 rounded-3xl shadow-soft-lg">
  <div class="text-center mb-8">
    <h2 class="text-3xl font-bold text-dark dark:text-light">
      Personalize Your Plan for <span class="text-primary">{{ skill() }}</span>
    </h2>
    <p class="mt-2 text-medium">A few details will help the Sage create the perfect path for you.</p>
  </div>

  <div class="space-y-8">
    <!-- Step 1: Plan Type -->
    <div>
        <h3 class="text-lg font-semibold text-dark dark:text-light">How should we structure your plan?</h3>
        <div class="mt-3 grid grid-cols-2 gap-3">
            <button 
              (click)="selectedPlanType.set('time')"
              [class.bg-primary]="selectedPlanType() === 'time'"
              [class.text-white]="selectedPlanType() === 'time'"
              [class.bg-gray-100]="selectedPlanType() !== 'time'"
              [class.dark:bg-gray-700]="selectedPlanType() !== 'time'"
              class="px-4 py-3 rounded-xl font-medium transition-colors text-center"
            >
              Time-driven
            </button>
            <button 
              (click)="selectedPlanType.set('purpose')"
              [class.bg-primary]="selectedPlanType() === 'purpose'"
              [class.text-white]="selectedPlanType() === 'purpose'"
              [class.bg-gray-100]="selectedPlanType() !== 'purpose'"
              [class.dark:bg-gray-700]="selectedPlanType() !== 'purpose'"
              class="px-4 py-3 rounded-xl font-medium transition-colors text-center"
            >
              Purpose-driven
            </button>
        </div>
    </div>

    <!-- Step 2: Goal (Conditional) -->
    @if (selectedPlanType() === 'time') {
      <div>
        <h3 class="text-lg font-semibold text-dark dark:text-light">What's your learning timeframe?</h3>
        <div class="mt-3 grid grid-cols-2 sm:grid-cols-4 gap-3">
          @for (goal of goals; track goal) {
            <button 
              (click)="selectedGoal.set(goal)"
              [class.bg-primary]="selectedGoal() === goal"
              [class.text-white]="selectedGoal() === goal"
              [class.bg-gray-100]="selectedGoal() !== goal"
              [class.dark:bg-gray-700]="selectedGoal() !== goal"
              class="px-4 py-3 rounded-xl font-medium transition-colors"
            >
              {{ goal }}
            </button>
          }
        </div>
        @if (selectedGoal() === 'Custom') {
          <div class="mt-3">
             <input 
              type="text"
              [ngModel]="customGoalText()"
              (ngModelChange)="customGoalText.set($event)"
              placeholder="e.g., 'In 2 weeks' or 'By the end of the year'"
              class="w-full px-4 py-3 bg-light dark:bg-dark-bg border border-gray-300 dark:border-gray-600 rounded-2xl focus:ring-2 focus:ring-primary focus:outline-none"
            >
          </div>
        }
      </div>
    } @else {
      <div>
        <label for="purpose-driven" class="text-lg font-semibold text-dark dark:text-light">What is your main purpose for learning this skill?</label>
        <input 
          id="purpose-driven"
          type="text"
          [ngModel]="purposeText()"
          (ngModelChange)="purposeText.set($event)"
          placeholder="e.g., 'To get a job as a frontend developer'"
          class="mt-3 w-full px-4 py-3 bg-light dark:bg-dark-bg border border-gray-300 dark:border-gray-600 rounded-2xl focus:ring-2 focus:ring-primary focus:outline-none"
        >
      </div>
    }

    <!-- Step 3: Time Commitment -->
    <div>
        <h3 class="text-lg font-semibold text-dark dark:text-light">How much time can you commit?</h3>
        <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
                <label for="days-per-week" class="text-sm font-medium text-medium">Days per week</label>
                <select id="days-per-week" [ngModel]="daysPerWeek()" (ngModelChange)="daysPerWeek.set($event)" class="mt-1 w-full px-4 py-3 bg-light dark:bg-dark-bg border border-gray-300 dark:border-gray-600 rounded-2xl focus:ring-2 focus:ring-primary focus:outline-none appearance-none">
                    @for(day of daysOptions; track day) {
                        <option [value]="day">{{day}} day{{day > 1 ? 's' : ''}}</option>
                    }
                </select>
            </div>
            <div>
                <label for="hours-per-session" class="text-sm font-medium text-medium">Hours per session</label>
                <input 
                    id="hours-per-session"
                    type="text"
                    [ngModel]="hoursPerSession()"
                    (ngModelChange)="hoursPerSession.set($event)"
                    placeholder="e.g., '90 minutes'"
                    class="mt-1 w-full px-4 py-3 bg-light dark:bg-dark-bg border border-gray-300 dark:border-gray-600 rounded-2xl focus:ring-2 focus:ring-primary focus:outline-none"
                >
            </div>
        </div>
    </div>
    
    <!-- Step 4: Framework -->
    <div>
      <h3 class="text-lg font-semibold text-dark dark:text-light">Choose Your Learning Style</h3>
      <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
        @for (framework of frameworks; track framework.id) {
          <button 
            (click)="selectedFramework.set(framework.id)"
            [class.ring-2]="selectedFramework() === framework.id"
            [class.ring-primary]="selectedFramework() === framework.id"
            class="p-4 rounded-xl text-left transition-all bg-gray-100 dark:bg-gray-700"
          >
            <p class="font-semibold">{{ framework.name }}</p>
            <p class="text-sm text-medium">{{ framework.description }}</p>
          </button>
        }
      </div>
    </div>

    <!-- Step 5: Custom Resources -->
    <div>
      <h3 class="text-lg font-semibold text-dark dark:text-light">Add Your Own Resources (Optional)</h3>
      <p class="text-sm text-medium mt-1">Upload a text file (.txt) containing notes, articles, or other materials you want the AI to consider when building your plan.</p>
      <div class="mt-3">
        @if (customResourceFileName()) {
          <div class="p-3 bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-between">
            <div class="flex items-center gap-2 overflow-hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-medium flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
              <span class="text-sm font-medium truncate">{{ customResourceFileName() }}</span>
            </div>
            <button (click)="removeCustomResource()" class="p-1 text-gray-500 hover:text-red-500 rounded-full flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
          </div>
        } @else {
          <label class="w-full flex justify-center px-6 py-10 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
            <div class="text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-10 w-10 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
              <p class="mt-2 text-sm font-semibold text-dark dark:text-light">Click to upload a .txt file</p>
              <p class="text-xs text-medium">Plain text only</p>
            </div>
            <input type="file" class="hidden" (change)="onFileSelected($event)" accept=".txt,text/plain">
          </label>
        }
      </div>
    </div>

  </div>

  <div class="mt-10">
    <button
      (click)="startAssessment()"
      class="w-full py-4 bg-primary text-white font-bold text-lg rounded-2xl shadow-soft hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-transform hover:scale-105"
    >
      Start Skill Assessment
    </button>
  </div>
</div>